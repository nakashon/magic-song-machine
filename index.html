<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸµ ××›×•× ×ª ×”×©×™×¨×™× ×”×§×¡×•××”</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700;800;900&display=swap');
    body { font-family: 'Rubik', sans-serif; }

    .rainbow-bg {
      background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
      background-size: 400% 400%;
      animation: rainbowShift 6s ease infinite;
    }
    @keyframes rainbowShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .bounce-in {
      animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .float {
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .wiggle:hover {
      animation: wiggle 0.4s ease-in-out;
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      75% { transform: rotate(5deg); }
    }

    .sparkle {
      animation: sparkle 1.5s ease-in-out infinite;
    }
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    .loading-dots span {
      animation: loadDot 1.4s infinite ease-in-out both;
    }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes loadDot {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    .option-btn {
      transition: all 0.2s ease;
    }
    .option-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .option-btn:active {
      transform: scale(0.97);
    }
    .option-btn.selected {
      ring: 4px;
      transform: scale(1.05);
    }

    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: confettiFall 3s ease-in forwards;
      pointer-events: none;
      z-index: 100;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body class="min-h-screen rainbow-bg flex items-center justify-center p-4">
  <div id="app"></div>

  <script>
    // ==================== APP STATE ====================
    const state = {
      currentStep: 0, // 0 = welcome, 1-5 = steps, 6 = magic word, 7 = loading, 8 = result
      choices: {},
      magicWord: '',
    };

    // ==================== OPTION POOLS (pick 4 random each time) ====================
    const optionPools = {
      rhythm: [
        { label: '×¤×•×¤ ××§×¤×™×¥', emoji: 'ğŸµ', en: 'upbeat pop' },
        { label: '×¨×•×§ ×›×‘×“', emoji: 'ğŸ¸', en: 'heavy rock' },
        { label: '×©×™×¨ ×¢×¨×©', emoji: 'ğŸŒ™', en: 'lullaby' },
        { label: '×”×™×¤-×”×•×¤', emoji: 'ğŸ¤', en: 'hip-hop' },
        { label: '×¨×’××™×™', emoji: 'ğŸï¸', en: 'reggae' },
        { label: '×“×™×¡×§×•', emoji: 'ğŸª©', en: 'disco' },
        { label: '×’×³××–', emoji: 'ğŸ·', en: 'jazz' },
        { label: '×˜×¨×× ×¡', emoji: 'ğŸ§', en: 'trance' },
        { label: '×§×× ×˜×¨×™', emoji: 'ğŸ¤ ', en: 'country' },
        { label: '×¡××‘×”', emoji: 'ğŸ’ƒ', en: 'samba' },
      ],
      topic: [
        { label: '×”×’×¨×‘×™×™× ×”××‘×•×“×•×ª', emoji: 'ğŸ§¦', en: 'lost socks' },
        { label: '×”×¤×¡×§×” ×‘×—×œ×œ', emoji: 'ğŸš€', en: 'recess in outer space' },
        { label: '××¡×™×‘×ª ×¤×™×¦×” ××•×–×¨×”', emoji: 'ğŸ•', en: 'a weird pizza party' },
        { label: '×”×™×œ×“×™× ×”×•×¤×›×™× ×œ×—×™×•×ª', emoji: 'ğŸ¦', en: 'kids turning into animals' },
        { label: '×¨×•×‘×•×˜ ×©×¨×•×¦×” ×œ×œ××•×“', emoji: 'ğŸ¤–', en: 'a robot who wants to go to school' },
        { label: '×“×™× ×•×–××•×¨ ×‘×¡×•×¤×¨', emoji: 'ğŸ¦•', en: 'a dinosaur at the supermarket' },
        { label: '×¢×•×’×™×•×ª ×©×‘×¨×—×• ××”×ª× ×•×¨', emoji: 'ğŸª', en: 'cookies that escaped the oven' },
        { label: '×’××“ ×©×’×™×œ×” ×¢× ×§', emoji: 'ğŸ§™', en: 'a dwarf who discovered a giant' },
        { label: '×—×ª×•×œ ×©×”×¤×š ×œ××œ×š', emoji: 'ğŸ‘‘', en: 'a cat who became king' },
        { label: '×©×™×¢×•×¨×™ ×‘×™×ª ×—×™×™×', emoji: 'ğŸ“š', en: 'homework that came alive' },
      ],
      location: [
        { label: '×”×¨ ×’×¢×© ×©×œ ×©×•×§×•×œ×“', emoji: 'ğŸŒ‹', en: 'a chocolate volcano' },
        { label: '×“×™×¡×§×• ××ª×—×ª ×œ××™×', emoji: 'ğŸ ', en: 'an underwater disco' },
        { label: '×‘×ª×•×š ×ª×™×§ ×’×‘', emoji: 'ğŸ’', en: 'inside a backpack' },
        { label: '×¢×œ ×¢× ×Ÿ ×¦××¨ ×’×¤×Ÿ', emoji: 'â˜ï¸', en: 'on a cotton candy cloud' },
        { label: '×‘×˜×™×¨×ª ×œ×’×• ×¢× ×§×™×ª', emoji: 'ğŸ°', en: 'in a giant LEGO castle' },
        { label: '×¢×œ ×¤×™×¦×” ××¢×•×¤×¤×ª', emoji: 'ğŸ›¸', en: 'on a flying pizza' },
        { label: '×‘×ª×•×š ×‘×•×¢×ª ×¡×‘×•×Ÿ', emoji: 'ğŸ«§', en: 'inside a soap bubble' },
        { label: '×‘×’×³×•× ×’×œ ×©×œ ×××ª×§×™×', emoji: 'ğŸ¬', en: 'in a candy jungle' },
        { label: '×¢×œ ×’×‘×™ ×§×©×ª ×‘×¢× ×Ÿ', emoji: 'ğŸŒˆ', en: 'on top of a rainbow' },
        { label: '×‘××’×¨×© ××©×—×§×™× ×¢×œ ×”×™×¨×—', emoji: 'ğŸŒ™', en: 'a playground on the moon' },
      ],
      twist: [
        { label: '×§×•×œ×•×ª ×©×œ ×ª×¨× ×’×•×œ', emoji: 'ğŸ“', en: 'chicken clucking sounds' },
        { label: '×–××¨ ×¢× ××£ ×¡×ª×•×', emoji: 'ğŸ¤§', en: 'a singer with a stuffy nose' },
        { label: '×§×˜×¢ ××•×¤×¨×”', emoji: 'ğŸ­', en: 'a dramatic opera section' },
        { label: '×‘×•×¢×•×ª ×¡×‘×•×Ÿ', emoji: 'ğŸ«§', en: 'soap bubble sound effects' },
        { label: '×©×™×”×•×§×™× ×‘×œ×™ ×¡×•×£', emoji: 'ğŸ˜µ', en: 'endless hiccups' },
        { label: '×¦×¢×§×” ×©×œ ×˜××¨×–×Ÿ', emoji: 'ğŸ¦', en: 'a Tarzan yell' },
        { label: '×§×•×œ×•×ª ×©×œ ×—×™×™×–×¨×™×', emoji: 'ğŸ‘½', en: 'alien sound effects' },
        { label: '×›×•×œ× ××“×‘×¨×™× ×‘×©×™×¨', emoji: 'ğŸ¶', en: 'everyone talks in song' },
        { label: '×’×™×”×•×§ ×¢× ×§', emoji: 'ğŸ˜®', en: 'a giant burp' },
        { label: '×”×›×œ ×”×¤×•×š', emoji: 'ğŸ™ƒ', en: 'everything is backwards' },
      ],
      mood: [
        { label: '×©×˜×•×ª×™', emoji: 'ğŸ¤¡', en: 'silly and goofy' },
        { label: '××¤×—×™×“-××¦×—×™×§', emoji: 'ğŸ‘»', en: 'spooky but funny' },
        { label: '×—×’×™×’×™', emoji: 'ğŸ‰', en: 'celebratory and festive' },
        { label: '×× ×¨×’×˜×™', emoji: 'âš¡', en: 'energetic and wild' },
        { label: '×—×•×œ×× ×™', emoji: 'ğŸŒŸ', en: 'dreamy and magical' },
        { label: '××˜×•×¨×£', emoji: 'ğŸ¤¯', en: 'crazy and chaotic' },
        { label: '××ª×•×§', emoji: 'ğŸ¥°', en: 'sweet and adorable' },
        { label: '×”×¨×¤×ª×§× ×™', emoji: 'ğŸ—ºï¸', en: 'adventurous and epic' },
      ],
    };

    // Pick 4 random from a pool
    function pickRandom(arr, count) {
      const shuffled = [...arr].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    // Current randomized steps (regenerated on each restart)
    let steps = [];

    function generateSteps() {
      steps = [
        { title: '×”×§×¦×‘', subtitle: '××™×–×” ×¡×•×’ ××•×–×™×§×” × ×¢×©×”?', emoji: 'ğŸ¥', key: 'rhythm', options: pickRandom(optionPools.rhythm, 4) },
        { title: '×”× ×•×©×', subtitle: '×¢×œ ××” ×”×©×™×¨?', emoji: 'ğŸ’¡', key: 'topic', options: pickRandom(optionPools.topic, 4) },
        { title: '×”××§×•×', subtitle: '××™×¤×” ×–×” ×§×•×¨×”?', emoji: 'ğŸ“', key: 'location', options: pickRandom(optionPools.location, 4) },
        { title: '××” ××¦×—×™×§?', subtitle: '××” ×”×“×‘×¨ ×”××©×•×’×¢ ×‘×©×™×¨?', emoji: 'ğŸ¤ª', key: 'twist', options: pickRandom(optionPools.twist, 4) },
        { title: '×”××•×•×™×¨×”', subtitle: '××™×–×” ×”×¨×’×©×”?', emoji: 'âœ¨', key: 'mood', options: pickRandom(optionPools.mood, 4) },
      ];
    }

    // ==================== POEMS (by topic â€” fallback for any topic) ====================
    const poems = {
      '×”×’×¨×‘×™×™× ×”××‘×•×“×•×ª': `ğŸ§¦ ×”×’×¨×‘×™×™× ×‘×¨×—×• ××”××¨×•×Ÿ ×‘×œ×™×œ×”
×”×Ÿ ×¨×•×§×“×•×ª ×‘×¨×—×•×‘ ×‘×œ×™ ×©×•× ×¡×™×‘×”
××—×ª ×™××™× ×” ×•××—×ª ×©×××œ×”
×•×›×•×œ×Ÿ ×¦×•×¢×§×•×ª: "×—×•×¤×©! ××™×–×• ×©××—×”!"`,
      '×”×¤×¡×§×” ×‘×—×œ×œ': `ğŸš€ ×‘×”×¤×¡×§×” ×¢×¤× ×• ×œ×—×œ×œ ×”×—×™×¦×•×Ÿ
××›×œ× ×• ×›×¨×™×š ×©×¦×£ ×‘××•×•×™×¨ ×›××• ×‘×œ×•×Ÿ
×©×™×—×§× ×• ×›×“×•×¨ ×¢×œ ×”×™×¨×— ×”×’×“×•×œ
×•××– ×—×–×¨× ×• ×œ×›×™×ª×” ×›×™ ×¦×œ×¦×œ ×”×¤×¢××•×Ÿ!`,
      '××¡×™×‘×ª ×¤×™×¦×” ××•×–×¨×”': `ğŸ• ×”×¤×™×¦×” ×”×–××™× ×” ××ª ×›×•×œ× ×œ××¡×™×‘×”
×¢× ×ª×•×¡×¤×•×ª ××•×–×¨×•×ª - ×©×•×§×•×œ×“ ×•×××ª×§ ×•×’×œ×™×“×”
×”×’×‘×™× ×” ×¨×§×“×” ×¡×œ×¡×” ×¢×œ ×”×‘×¦×§
×•×‘×¡×•×£ ×›×•×œ× ×××¨×•: "×¢×•×“ ×¤×¨×•×¡×”, ×‘×‘×§×©×”!"`,
      '×”×™×œ×“×™× ×”×•×¤×›×™× ×œ×—×™×•×ª': `ğŸ¦ ×‘×•×§×¨ ××—×“ ×§××ª×™ ×•×”×™×™×ª×™ ×’×³×™×¨×¤×”
×¨××™×ª×™ ××ª ×›×•×œ× - ×›×œ ×”×›×™×ª×”! ××™×–×• ×©××—×”
×“× ×™ ×”×™×” ×¤× ×’×•×•×™×Ÿ ×•× ×•×¢×” ×”×™×™×ª×” ×—×ª×•×œ×”
×•×”××•×¨×”? ×”×™× ×”×¤×›×” ×œ×ª×•×›×™ - ×•×××¨×”: "×©×œ×•× ×›×™×ª×”!"`,
      '×¨×•×‘×•×˜ ×©×¨×•×¦×” ×œ×œ××•×“': `ğŸ¤– ×¨×•×‘×•×˜ ×§×˜×Ÿ ×‘× ×œ×‘×™×ª ×”×¡×¤×¨
×”×•× ×™×©×‘ ×‘×›×™×ª×” ×•×××¨ "×‘×™×¤ ×‘×™×¤ ×©×™×¢×•×¨!"
×”×•× ×›×ª×‘ ×‘××—×‘×¨×ª ×¢× ××‘×¨×’ ×‘××§×•× ×¢×˜
×•×”××•×¨×” ×××¨×”: "!××ª×” ×”×ª×œ××™×“ ×”×›×™ ×©×§×˜"`,
      '×“×™× ×•×–××•×¨ ×‘×¡×•×¤×¨': `ğŸ¦• ×“×™× ×•×–××•×¨ × ×›× ×¡ ×œ×¡×•×¤×¨××¨×§×˜
×”×•× ×¨×¦×” ×©×•×§×•×œ×“ ××‘×œ ×©×‘×¨ ××ª ×”××“×£
×”×§×•×¤××™×ª ×¦×¢×§×”: "!××™ ××¤×©×¨ ×›×›×”"
×•×”×“×™× ×•×–××•×¨ ×¢× ×”: "×¡×œ×™×—×”, ×× ×™ ×¨×§ ×¨×•×¦×” ×—×˜×™×¤×”!"`,
      '×¢×•×’×™×•×ª ×©×‘×¨×—×• ××”×ª× ×•×¨': `ğŸª ×”×¢×•×’×™×•×ª ×§×¤×¦×• ××”×ª×‘× ×™×ª ×•×¨×¦×•
×”×Ÿ ×˜×™×¤×¡×• ×¢×œ ×”×©×•×œ×—×Ÿ ×•×¨×§×“×•
×¢×•×’×™×” ××—×ª ×¦×¢×§×”: "!×× ×—× ×• ×—×•×¤×©×™×•×ª"
×•××– ×›×•×œ×Ÿ × ×¤×œ×• ×œ×ª×•×š ×›×•×¡ ×”×—×œ×‘ - ××•×¤×¡!`,
      '×’××“ ×©×’×™×œ×” ×¢× ×§': `ğŸ§™ ×’××“ ×§×˜× ×˜×Ÿ ××¦× ×¢× ×§ ×™×©×Ÿ
×”×•× ×˜×™×¤×¡ ×¢×œ ×”××£ ×©×œ×• - ××™×–×” ×›×™×£ ×××©!
×”×¢× ×§ ×”×ª×¢×˜×© ×•×”×’××“ ×¢×£ ×œ×©××™×™×
×•××– ×”× ×”×¤×›×• ×œ×—×‘×¨×™× ×”×›×™ ×˜×•×‘×™×!`,
      '×—×ª×•×œ ×©×”×¤×š ×œ××œ×š': `ğŸ‘‘ ×—×ª×•×œ ×œ×‘×© ×›×ª×¨ ×•×™×©×‘ ×¢×œ ×›×™×¡×
×”×•× ×’×–×¨: "!××”×™×•× ×›×•×œ× ××•×›×œ×™× ×˜×•× ×”"
×”×›×œ×‘×™× ××—×• ×•×”×¦×™×¤×•×¨×™× ×¦×™×™×¦×•
××‘×œ ×”×—×ª×•×œ ×¨×§ ×™×©×Ÿ - ×›×™ ×–×” ××” ×©×—×ª×•×œ×™× ×¢×•×©×™×!`,
      '×©×™×¢×•×¨×™ ×‘×™×ª ×—×™×™×': `ğŸ“š ×©×™×¢×•×¨×™ ×”×‘×™×ª ×§××• ×œ×—×™×™× ×‘×œ×™×œ×”
×”××—×‘×¨×ª ×¨×¦×” ×•×”×¢×˜ ×”×ª×—×™×œ ×œ×©×™×¨
×”××¡×¤×¨×™× ×¨×§×“×• ×˜× ×’×• ×¢× ×”××•×ª×™×•×ª
×•×”××•×¨×” ×××¨×”: "!××—×¨ ××ª× ××’×™×©×™× - ×‘×œ×™ ×ª×™×¨×•×¦×™×"`,
    };

    // Fallback poem for topics without a specific poem
    function getPoem(topicLabel) {
      if (poems[topicLabel]) return poems[topicLabel];
      return `ğŸ¶ ×©×™×¨ ×¢×œ ${topicLabel}
×–×” ×”×•×œ×š ×œ×”×™×•×ª ××“×”×™× ×•××¦×—×™×§
×¢× ××œ× ×”×¤×ª×¢×•×ª ×•×“×‘×¨×™× ××©×•×’×¢×™×
×‘×•××• × ×©××¢ ××ª ×–×” ×•× ×¨×§×•×“ ×‘×™×—×“!`;
    }

    // ==================== PROMPT BUILDER (partial, for live preview) ====================
    function buildPartialPrompt() {
      const c = state.choices;
      const parts = [];
      if (c.rhythm) parts.push(`${c.rhythm.en} style`);
      if (c.topic) parts.push(`about ${c.topic.en}`);
      if (c.location) parts.push(`set at ${c.location.en}`);
      if (c.twist) parts.push(`with ${c.twist.en}`);
      if (c.mood) parts.push(`${c.mood.en} mood`);
      if (state.magicWord.trim()) parts.push(`magic word: "${state.magicWord}"`);
      if (parts.length === 0) return '';
      return `A fun children's song: ${parts.join(' Â· ')}`;
    }

    function buildPrompt() {
      const c = state.choices;
      return `A fun, ${c.mood.en} children's song in ${c.rhythm.en} style about ${c.topic.en}. ` +
        `Set at ${c.location.en}. ` +
        `Include ${c.twist.en} as a funny element. ` +
        `The magic word "${state.magicWord}" should be featured prominently. ` +
        `Catchy, kid-friendly, singalong chorus, playful and energetic vocals, silly sound effects.`;
    }

    // ==================== LIVE PROMPT PREVIEW ====================
    function renderPromptPreview() {
      const partial = buildPartialPrompt();
      if (!partial) return '';
      return `
        <div class="mt-5 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-3 border border-indigo-200">
          <div class="flex items-center gap-2 text-sm font-bold text-indigo-600 mb-1">ğŸ¤– ×”×¤×¨×•××¤×˜ × ×‘× ×”:</div>
          <p class="text-sm text-indigo-800 font-mono leading-relaxed" dir="ltr">${partial}</p>
        </div>`;
    }

    // ==================== RENDER ====================
    function render() {
      const app = document.getElementById('app');

      if (state.currentStep === 0) {
        app.innerHTML = renderWelcome();
      } else if (state.currentStep <= 5) {
        app.innerHTML = renderStep(state.currentStep - 1);
      } else if (state.currentStep === 6) {
        app.innerHTML = renderMagicWord();
      } else if (state.currentStep === 7) {
        app.innerHTML = renderLoading();
        setTimeout(() => { state.currentStep = 8; render(); spawnConfetti(); }, 2500);
      } else if (state.currentStep === 8) {
        app.innerHTML = renderResult();
      }
    }

    // ==================== SCREENS ====================
    function renderWelcome() {
      return `
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8 md:p-12 max-w-lg w-full text-center bounce-in">
          <div class="text-8xl float mb-4">ğŸµ</div>
          <h1 class="text-4xl md:text-5xl font-black text-purple-600 mb-3">××›×•× ×ª ×”×©×™×¨×™×</h1>
          <h2 class="text-2xl md:text-3xl font-bold text-pink-500 mb-6">×”×§×¡×•××” âœ¨</h2>
          <p class="text-lg text-gray-600 mb-8">×‘×•××• × ×™×¦×•×¨ ×©×™×¨ ××˜×•×¨×£ ×‘×™×—×“!</p>
          <button onclick="nextStep()"
            class="option-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white text-2xl font-bold py-4 px-10 rounded-full shadow-lg">
            ğŸš€ ×™××œ×œ×” ××ª×—×™×œ×™×!
          </button>
        </div>`;
    }

    function renderStep(idx) {
      const step = steps[idx];
      const progress = ((idx + 1) / 6 * 100).toFixed(0);
      const colors = [
        ['from-red-400', 'to-orange-400', 'bg-red-100', 'ring-red-400', 'text-red-700'],
        ['from-blue-400', 'to-cyan-400', 'bg-blue-100', 'ring-blue-400', 'text-blue-700'],
        ['from-green-400', 'to-emerald-400', 'bg-green-100', 'ring-green-400', 'text-green-700'],
        ['from-yellow-400', 'to-amber-400', 'bg-yellow-100', 'ring-yellow-400', 'text-yellow-700'],
        ['from-purple-400', 'to-violet-400', 'bg-purple-100', 'ring-purple-400', 'text-purple-700'],
      ];
      const c = colors[idx];

      return `
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-6 md:p-10 max-w-xl w-full bounce-in">
          <!-- Progress -->
          <div class="mb-6">
            <div class="flex justify-between text-sm font-bold text-gray-500 mb-1">
              <span>×©×œ×‘ ${idx + 1} ××ª×•×š 6</span>
              <span>${progress}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
              <div class="h-full bg-gradient-to-l ${c[0]} ${c[1]} rounded-full transition-all duration-500" style="width:${progress}%"></div>
            </div>
          </div>
          <!-- Title -->
          <div class="text-center mb-6">
            <div class="text-5xl mb-2">${step.emoji}</div>
            <h2 class="text-3xl font-black ${c[4]}">${step.title}</h2>
            <p class="text-lg text-gray-500 mt-1">${step.subtitle}</p>
          </div>
          <!-- Options -->
          <div class="grid grid-cols-2 gap-4">
            ${step.options.map((opt, i) => `
              <button onclick="selectOption('${step.key}', ${i})"
                class="option-btn wiggle ${c[2]} rounded-2xl p-5 text-center cursor-pointer border-2 border-transparent hover:border-gray-300">
                <div class="text-4xl mb-2">${opt.emoji}</div>
                <div class="text-lg font-bold text-gray-800">${opt.label}</div>
              </button>
            `).join('')}
          </div>
          <!-- Live prompt preview -->
          ${renderPromptPreview()}
          <!-- Nav (back only â€” forward is automatic on click) -->
          <div class="flex justify-start mt-4">
            ${idx > 0 ? `<button onclick="prevStep()" class="text-gray-400 hover:text-gray-600 text-lg font-bold py-2 px-4 rounded-full">â†’ ×—×–×¨×”</button>` : ''}
          </div>
        </div>`;
    }

    function renderMagicWord() {
      return `
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-6 md:p-10 max-w-xl w-full bounce-in text-center">
          <div class="mb-6">
            <div class="flex justify-between text-sm font-bold text-gray-500 mb-1">
              <span>×©×œ×‘ 6 ××ª×•×š 6</span>
              <span>100%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
              <div class="h-full bg-gradient-to-l from-pink-400 to-red-400 rounded-full" style="width:100%"></div>
            </div>
          </div>
          <div class="text-6xl mb-3 sparkle">ğŸª„</div>
          <h2 class="text-3xl font-black text-pink-600 mb-2">××™×œ×ª ×”×§×¡×</h2>
          <p class="text-lg text-gray-500 mb-6">×‘×—×¨×• ××™×œ×” ××—×ª ××™×•×—×“×ª ×©×ª×™×›× ×¡ ×œ×©×™×¨!</p>
          <input type="text" id="magicInput" value="${state.magicWord}" placeholder="...×›×ª×‘×• ××™×œ×” ×§×¡×•××”"
            oninput="state.magicWord = this.value; updateGenerateBtn();"
            class="text-center text-2xl font-bold w-full border-4 border-pink-300 rounded-2xl py-4 px-6 focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-200 bg-pink-50 placeholder-pink-300" />
          ${renderPromptPreview()}
          <div class="flex justify-between mt-6">
            <button onclick="prevStep()" class="text-gray-400 hover:text-gray-600 text-lg font-bold py-2 px-4 rounded-full">
              â†’ ×—×–×¨×”
            </button>
            <button onclick="generateSong()" id="generateBtn" disabled
              class="bg-gradient-to-r from-pink-500 to-red-500 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg disabled:opacity-30 disabled:cursor-not-allowed option-btn">
              ğŸµ ×œ×™×¦×•×¨ ××ª ×”×©×™×¨!
            </button>
          </div>
        </div>`;
    }

    function renderLoading() {
      return `
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-10 max-w-md w-full text-center bounce-in">
          <div class="text-7xl sparkle mb-6">ğŸª„</div>
          <h2 class="text-3xl font-black text-purple-600 mb-4">...××›×™× ×™× ××ª ×”×§×¡×</h2>
          <div class="loading-dots flex justify-center gap-3">
            <span class="w-5 h-5 bg-purple-500 rounded-full inline-block"></span>
            <span class="w-5 h-5 bg-pink-500 rounded-full inline-block"></span>
            <span class="w-5 h-5 bg-yellow-500 rounded-full inline-block"></span>
          </div>
        </div>`;
    }

    function renderResult() {
      const c = state.choices;
      const prompt = buildPrompt();
      const topicLabel = c.topic.label;
      const poem = getPoem(topicLabel);

      return `
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-6 md:p-10 max-w-2xl w-full bounce-in">
          <div class="text-center mb-6">
            <div class="text-6xl mb-2">ğŸ‰</div>
            <h2 class="text-3xl font-black text-purple-600">!×”×©×™×¨ ××•×›×Ÿ</h2>
          </div>

          <!-- Summary -->
          <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-5 mb-5 border-2 border-purple-200">
            <h3 class="text-xl font-bold text-purple-700 mb-3">ğŸµ ×”×‘×—×™×¨×•×ª ×©×œ× ×•:</h3>
            <div class="grid grid-cols-2 gap-2 text-lg">
              <div class="flex items-center gap-2"><span>ğŸ¥</span><strong>×§×¦×‘:</strong> ${c.rhythm.label}</div>
              <div class="flex items-center gap-2"><span>ğŸ’¡</span><strong>× ×•×©×:</strong> ${c.topic.label}</div>
              <div class="flex items-center gap-2"><span>ğŸ“</span><strong>××§×•×:</strong> ${c.location.label}</div>
              <div class="flex items-center gap-2"><span>ğŸ¤ª</span><strong>××¦×—×™×§:</strong> ${c.twist.label}</div>
              <div class="flex items-center gap-2"><span>âœ¨</span><strong>××•×•×™×¨×”:</strong> ${c.mood.label}</div>
              <div class="flex items-center gap-2"><span>ğŸª„</span><strong>××™×œ×ª ×§×¡×:</strong> ${state.magicWord}</div>
            </div>
          </div>

          <!-- Poem -->
          <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl p-5 mb-5 border-2 border-yellow-300">
            <h3 class="text-xl font-bold text-orange-700 mb-2">ğŸ“ ××™×œ×•×ª ×”×©×™×¨:</h3>
            <pre class="text-lg text-gray-800 whitespace-pre-wrap font-[Rubik] leading-relaxed">${poem}</pre>
          </div>

          <!-- Suno Prompt -->
          <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 mb-5 border-2 border-blue-300">
            <h3 class="text-xl font-bold text-blue-700 mb-2">ğŸ¤– Suno Prompt:</h3>
            <p id="sunoPrompt" class="text-base text-gray-700 leading-relaxed font-mono bg-white/70 p-3 rounded-xl" dir="ltr">${prompt}</p>
          </div>

          <!-- Actions -->
          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <button onclick="copyPrompt()"
              id="copyBtn"
              class="option-btn bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg">
              ğŸ“‹ ×”×¢×ª×§ ×¤×¨×•××¤×˜
            </button>
            <button onclick="startOver()"
              class="option-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg">
              ğŸ”„ ×©×™×¨ ×—×“×©!
            </button>
          </div>
        </div>`;
    }

    // ==================== LOGIC ====================
    function selectOption(key, index) {
      const stepIdx = steps.findIndex(s => s.key === key);
      const opt = steps[stepIdx].options[index];
      state.choices[key] = { label: opt.label, en: opt.en, emoji: opt.emoji, index };
      // Auto-advance to next step after a short visual delay
      setTimeout(() => { state.currentStep++; render(); }, 350);
    }

    function nextStep() {
      state.currentStep++;
      render();
    }

    function prevStep() {
      if (state.currentStep > 0) {
        state.currentStep--;
        render();
      }
    }

    function generateSong() {
      state.currentStep = 7;
      render();
    }

    function updateGenerateBtn() {
      const btn = document.getElementById('generateBtn');
      if (btn) btn.disabled = !state.magicWord.trim();
    }

    function startOver() {
      state.currentStep = 0;
      state.choices = {};
      state.magicWord = '';
      generateSteps(); // Randomize options for next round!
      render();
    }

    function copyPrompt() {
      const text = document.getElementById('sunoPrompt').innerText;
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'âœ… !×”×•×¢×ª×§';
        setTimeout(() => { btn.textContent = 'ğŸ“‹ ×”×¢×ª×§ ×¤×¨×•××¤×˜'; }, 2000);
      });
    }

    function spawnConfetti() {
      const colors = ['#ff6b6b','#feca57','#48dbfb','#ff9ff3','#54a0ff','#5f27cd','#1dd1a1','#ff9f43'];
      for (let i = 0; i < 60; i++) {
        const el = document.createElement('div');
        el.className = 'confetti-piece';
        el.style.left = Math.random() * 100 + 'vw';
        el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        el.style.animationDelay = Math.random() * 2 + 's';
        el.style.width = (Math.random() * 8 + 6) + 'px';
        el.style.height = el.style.width;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 5000);
      }
    }

    // ==================== INIT ====================
    generateSteps();
    render();
  </script>
</body>
</html>
